seml:
  executable: /home/icb/alessandro.palma/imCPA/compert/train.py
  name: resnet_sweep
  output_dir: /lustre/groups/ml01/workspace/alessandro.palma/imCPA/results/learning_rate_sweep
  conda_environment: imgCPA
  project_root_dir: /home/icb/alessandro.palma/imCPA

slurm:
  max_simultaneous_jobs: 10
  experiments_per_job: 1
  sbatch_options_template: GPU
  sbatch_options:
    gres: gpu:1       # num GPUs
    mem: 90G          # memory
    cpus-per-task: 6  # num cores
    time: 2-00:00     # max time, D-HH:MM

########## HUPERPARAMETER TUNING ##########

fixed:
  paths.experiment_name: learning_rate_sweep
  paths.image_path: /home/icb/alessandro.palma/data/cellpainting_100
  paths.data_index_path: /home/icb/alessandro.palma/data/data_index/integrated/200k
  paths.embeddings_path: /home/icb/alessandro.palma/data/metadata_processed/original/embeddings/rdkit/rdkit2D_embedding_cellpainting.csv
  paths.use_embeddings: True
  paths.result_path: /lustre/groups/ml01/workspace/alessandro.palma/imCPA/results/learning_rate_sweep

  resume.resume: False
  resume.resume_checkpoint: ""

  training_params.img_plot: True
  training_params.save_results: True 
  training_params.num_epochs: 30
  training_params.batch_size: 256
  training_params.eval: True   
  training_params.eval_every: 1
  training_params.n_workers_loader: 4 
  training_params.generate: False
  training_params.model_name: AE
  training_params.temperature: null
  training_params.augment_train: True
  training_params.patience: 10
  training_params.seed: 42
  training_params.predict_n_cells: False
  training_params.append_layer_width: null

  image_params.in_width: 100
  image_params.in_height: 100
  image_params.in_channels: 5

  model.hparams.latent_dim: 1024
  model.hparams.init_fm: 64
  model.hparams.n_conv: 3
  model.hparams.n_residual_blocks: 18
  model.hparams.adversary_width: 512
  model.hparams.adversary_depth: 3
  # model.hparams.reg_adversary: 100
  model.hparams.penalty_adversary: 3
  # model.hparams.autoencoder_lr: 1e-4
  # model.hparams.adversary_lr: 1e-3
  # model.hparams.autoencoder_wd: 1e-6
  # model.hparams.adversary_wd: 1e-6
  # model.hparams.adversary_steps: 50 
  model.hparams.step_size_lr: 512
  model.hparams.embedding_encoder_width: 512 
  model.hparams.embedding_encoder_depth: 1
  model.hparams.warmup_steps: 1
  model.hparams.data_driven_sigma: True
  model.hparams.ae_pretrain: True
  model.hparams.ae_pretrain_steps: 3
  batch_norm_adversarial: True 
  batch_norm_layers_ae: False 
  dropout_ae: False 
  dropout_rate_ae: 0
  

random:
  samples: 15
  seed: 42

  model.hparams.reg_adversary:
    type: choice 
    options:
      - 1000
      - 100
      - 10

  model.hparams.adversary_steps:
    type: choice
    options:
      - 10
      - 100
    
  model.hparams.autoencoder_lr:
    type: loguniform
        min: 1e-5
        max: 1e-2

  model.hparams.adversary_lr:
    type: loguniform
        min: 1e-5
        max: 1e-2
    
  model.hparams.autoencoder_wd:
    type: loguniform
        min: 1e-6
        max: 1e-2

  model.hparams.adversary_wd:
    type: loguniform
        min: 1e-6
        max: 1e-2
     
